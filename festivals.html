<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌûêÎßÅK - Ïã§ÏãúÍ∞Ñ Ï∂ïÏ†ú Î∞è Í¥ÄÍ¥ë Ï†ïÎ≥¥</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #6D9FFF; /* ÌååÏä§ÌÖî Î∏îÎ£® */
            --secondary-color: #FFD6A5; /* ÌååÏä§ÌÖî Ïò§Î†åÏßÄ */
            --accent-color: #C8E6C9; /* ÌååÏä§ÌÖî Í∑∏Î¶∞ */
            --text-color: #333;
            --bg-color: #FFFFFF;
            --container-bg-color: #F8F9FA;
            --border-color: #E0E0E0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            background-color: var(--container-bg-color);
            border-radius: 12px;
            box-shadow: 0 8px 16px var(--shadow-color);
            padding: 25px;
            transition: all 0.3s ease-in-out;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .region-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .region-selector label {
            font-size: 1.1em;
            font-weight: 500;
        }

        .region-selector select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 1em;
            background-color: var(--bg-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .region-selector select:hover, .region-selector select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(109, 159, 255, 0.2);
        }


        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .info-card {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
        }

        .info-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .info-card h2 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
        }
        
        .info-card h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-card p, .info-card li {
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .info-card strong {
            font-weight: 500;
        }

        .festival-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .festival-tabs button {
            padding: 10px 18px;
            border: none;
            background-color: transparent;
            color: var(--text-color);
            cursor: pointer;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }

        .festival-tabs button.active, .festival-tabs button:hover {
            background-color: var(--primary-color);
            color: var(--bg-color);
        }

        .festival-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .festival-item {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px var(--shadow-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .festival-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.12);
        }

        .festival-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
            background-color: #eee; /* Placeholder bg */
        }
        .festival-item h4 {
            margin: 0 0 5px 0;
            color: var(--primary-color);
            font-size: 1.1em;
        }
        .festival-item p {
            font-size: 0.85em;
            margin-bottom: 5px;
            color: #555;
        }
        .festival-item .days-left {
            font-weight: bold;
            color: var(--secondary-color);
        }
         .festival-item .status-ongoing { color: #4CAF50; font-weight: bold; }
        .festival-item .status-upcoming { color: #FF9800; font-weight: bold; }


        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .ranking-table th, .ranking-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .ranking-table th {
            background-color: var(--accent-color);
            color: var(--text-color);
            font-weight: 500;
        }
        .ranking-table tr:hover {
            background-color: #f1f1f1;
        }
        .ranking-table .rank { font-weight: bold; color: var(--primary-color); }
        .ranking-table .score { font-weight: bold; }

        .loader {
            display: none; /* Hidden by default */
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid var(--primary-color); /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            z-index: 1000;
        }
        
        .error-message {
            color: red;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background-color: #ffebee;
            border: 1px solid red;
            border-radius: 6px;
            margin-top: 15px;
        }

        .api-message {
            font-size: 0.85em;
            color: #757575;
            margin-top: 5px;
            text-align: right;
        }
        
        .data-time {
            font-size: 0.8em;
            color: #888;
            margin-top: 3px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9em;
            color: #777;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-container { padding: 15px; }
            header h1 { font-size: 2em; }
            .info-card h2 { font-size: 1.4em; }
            .festival-tabs button { padding: 8px 12px; font-size: 0.9em; }
        }

    </style>
</head>
<body>
    <div class="loader" id="loader"></div>

    <div class="app-container">
        <header>
            <h1>ÌûêÎßÅK Ï†ïÎ≥¥ ÏÑúÎπÑÏä§</h1>
            <p>ÎåÄÌïúÎØºÍµ≠Ïùò Ïã§ÏãúÍ∞Ñ ÎÇ†Ïî®, ÎåÄÍ∏∞Ïßà, Ï∂ïÏ†ú, Í¥ÄÍ¥ë Ï†ïÎ≥¥Î•º ÌïúÎààÏóê!</p>
        </header>

        <div class="region-selector">
            <label for="region">ÏßÄÏó≠ ÏÑ†ÌÉù:</label>
            <select id="region">
                <option value="ÏÑúÏö∏">ÏÑúÏö∏</option>
                <option value="Î∂ÄÏÇ∞">Î∂ÄÏÇ∞</option>
                <option value="Ï†úÏ£º">Ï†úÏ£º</option>
                <option value="Í∞ïÎ¶â">Í∞ïÎ¶â</option>
                <option value="Ï†ÑÏ£º">Ï†ÑÏ£º</option>
                <option value="ÎåÄÍµ¨">ÎåÄÍµ¨</option>
                <option value="Í¥ëÏ£º">Í¥ëÏ£º</option>
                <option value="ÎåÄÏ†Ñ">ÎåÄÏ†Ñ</option>
            </select>
        </div>

        <div id="error-display" class="error-message" style="display: none;"></div>
        
        <section id="combined-info-section" class="info-card">
            <h2><span id="current-region-title">ÏÑúÏö∏</span> Ï¢ÖÌï© Ï†ïÎ≥¥ üåü</h2>
            <div id="combined-content">
                <p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
            </div>
            <p class="api-message" id="combined-message"></p>
            <p class="data-time" id="combined-time"></p>
        </section>

        <div class="info-grid">
            <section id="weather-section" class="info-card">
                <h2>ÎÇ†Ïî® üå§Ô∏è</h2>
                <div id="weather-content">
                    <p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
                </div>
                <p class="api-message" id="weather-message"></p>
                <p class="data-time" id="weather-time"></p>
            </section>

            <section id="air-quality-section" class="info-card">
                <h2>ÎåÄÍ∏∞Ïßà üå¨Ô∏è</h2>
                <div id="air-quality-content">
                    <p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
                </div>
                <p class="api-message" id="air-quality-message"></p>
                <p class="data-time" id="air-quality-time"></p>
            </section>
        </div>
        
        <section id="festivals-section" class="info-card">
            <h2>Ï∂ïÏ†ú Ï†ïÎ≥¥ üé™ (<span id="festival-region-title">ÏÑúÏö∏</span>)</h2>
            <div class="festival-tabs">
                <button class="active" data-tab="ongoing">ÏßÑÌñâ Ï§ë</button>
                <button data-tab="upcoming">ÏòàÏ†ï</button>
                <button data-tab="thisWeekend">Ïù¥Î≤à Ï£ºÎßê</button>
            </div>
            <div id="festivals-stats" style="margin-bottom: 10px; font-size: 0.9em;"></div>
            <div id="festivals-content" class="festival-list">
                <p>Ï∂ïÏ†ú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
            </div>
             <p class="api-message" id="festivals-main-message"></p>
             <p class="data-time" id="festivals-time"></p>
        </section>

        <section id="tourism-section" class="info-card">
            <h2>Ï£ºÏöî Í¥ÄÍ¥ëÏßÄ Î∞è Ïù¥Î≤§Ìä∏ üèõÔ∏è (<span id="tourism-region-title">ÏÑúÏö∏</span>)</h2>
            <div id="tourism-content">
                <p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
            </div>
            <p class="api-message" id="tourism-message"></p>
            <p class="data-time" id="tourism-time"></p>
        </section>

        <section id="ranking-section" class="info-card">
            <h2>Í¥ÄÍ¥ëÏßÄ Îû≠ÌÇπ üèÜ</h2>
            <div id="ranking-content">
                <p>Îû≠ÌÇπ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>
            </div>
            <p class="api-message" id="ranking-message"></p>
            <p class="data-time" id="ranking-time"></p>
        </section>

        <footer>
            <p>&copy; <span id="current-year"></span> ÌûêÎßÅK ÌîÑÎ°úÏ†ùÌä∏. All rights reserved.</p>
            <p>Îç∞Ïù¥ÌÑ∞ Ï†úÍ≥µ: ÌïúÍµ≠Í¥ÄÍ¥ëÍ≥µÏÇ¨, Í∏∞ÏÉÅÏ≤≠, ÏóêÏñ¥ÏΩîÎ¶¨ÏïÑ Îì±</p>
            <p>Î≥∏ ÏÑúÎπÑÏä§ÏóêÏÑú Ï†úÍ≥µÌïòÎäî Ï†ïÎ≥¥Îäî Ïã§Ï†úÏôÄ Îã§ÏÜå Ï∞®Ïù¥Í∞Ä ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.</p>
        </footer>
    </div>

    <script>
        // Ï§ëÏöî: Ïù¥ URLÏùÑ Ïã§Ï†ú Vercel Î∞∞Ìè¨ URLÎ°ú Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî. (Ïòà: https://your-project-name.vercel.app)
        const VERCEL_BASE_URL = 'https://healingk.vercel.app/api'; // <--- Ïù¥ Î∂ÄÎ∂ÑÏùÑ ÏàòÏ†ïÌï¥Ï£ºÏÑ∏Ïöî!!!

        const loader = document.getElementById('loader');
        const errorDisplay = document.getElementById('error-display');

        const regionSelect = document.getElementById('region');
        
        const currentRegionTitle = document.getElementById('current-region-title');
        const festivalRegionTitle = document.getElementById('festival-region-title');
        const tourismRegionTitle = document.getElementById('tourism-region-title');

        const weatherContent = document.getElementById('weather-content');
        const weatherMessage = document.getElementById('weather-message');
        const weatherTime = document.getElementById('weather-time');

        const airQualityContent = document.getElementById('air-quality-content');
        const airQualityMessage = document.getElementById('air-quality-message');
        const airQualityTime = document.getElementById('air-quality-time');

        const combinedContent = document.getElementById('combined-content');
        const combinedMessage = document.getElementById('combined-message');
        const combinedTime = document.getElementById('combined-time');

        const festivalsContent = document.getElementById('festivals-content');
        const festivalsStats = document.getElementById('festivals-stats');
        const festivalsMainMessage = document.getElementById('festivals-main-message');
        const festivalsTime = document.getElementById('festivals-time');
        const festivalTabs = document.querySelector('.festival-tabs');
        let currentFestivalTab = 'ongoing';
        let festivalDataCache = null; // Ï∂ïÏ†ú Îç∞Ïù¥ÌÑ∞ Ï∫êÏã±Ïö©

        const tourismContent = document.getElementById('tourism-content');
        const tourismMessage = document.getElementById('tourism-message');
        const tourismTime = document.getElementById('tourism-time');
        
        const rankingContent = document.getElementById('ranking-content');
        const rankingMessage = document.getElementById('ranking-message');
        const rankingTime = document.getElementById('ranking-time');

        document.getElementById('current-year').textContent = new Date().getFullYear();

        function showLoader() {
            loader.style.display = 'block';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function showError(message) {
            errorDisplay.textContent = message;
            errorDisplay.style.display = 'block';
        }

        function clearError() {
            errorDisplay.textContent = '';
            errorDisplay.style.display = 'none';
        }

        async function fetchData(endpoint, params = {}) {
            if (VERCEL_BASE_URL === 'https://healingk.vercel.app/api') {
                console.error("VERCEL_BASE_URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Ïä§ÌÅ¨Î¶ΩÌä∏ ÏÉÅÎã®Ïùò Ìï¥Îãπ Î≥ÄÏàòÎ•º ÏàòÏ†ïÌï¥Ï£ºÏÑ∏Ïöî.");
                showError("Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏÑ§Ï†ï Ïò§Î•ò: VERCEL_BASE_URLÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.");
                // Î™®Îì† Ïª®ÌÖêÏ∏† ÏòÅÏó≠Ïóê Ïò§Î•ò Î©îÏãúÏßÄ ÌëúÏãú
                const placeholderText = "Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏÑ§Ï†ï Ïò§Î•òÏûÖÎãàÎã§.";
                weatherContent.innerHTML = `<p>${placeholderText}</p>`;
                airQualityContent.innerHTML = `<p>${placeholderText}</p>`;
                combinedContent.innerHTML = `<p>${placeholderText}</p>`;
                festivalsContent.innerHTML = `<p>${placeholderText}</p>`;
                tourismContent.innerHTML = `<p>${placeholderText}</p>`;
                rankingContent.innerHTML = `<p>${placeholderText}</p>`;
                return null;
            }
            
            showLoader();
            clearError();
            
            const queryParams = new URLSearchParams(params).toString();
            const url = `${VERCEL_BASE_URL}/api/${endpoint}${queryParams ? '?' + queryParams : ''}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                hideLoader();
                return data;
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                showError(`Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§ (${endpoint}): ${error.message}`);
                hideLoader();
                return { success: false, message: `ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ Ïò§Î•ò: ${error.message}` }; // API ÏùëÎãµ ÌòïÏãùÏóê ÎßûÍ≤å Î∞òÌôò
            }
        }

        function displayWeatherData(data) {
            if (data && data.success && data.data) {
                const weather = data.data;
                weatherContent.innerHTML = `
                    <p><strong>Ïò®ÎèÑ:</strong> ${weather.temperature}¬∞C</p>
                    <p><strong>ÌïòÎäò:</strong> ${weather.sky}</p>
                    <p><strong>Í∞ïÏàò:</strong> ${weather.precipitation || 'Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                `;
                weatherMessage.textContent = weather.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                weatherTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${weather.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                weatherContent.innerHTML = `<p>ÎÇ†Ïî® Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                weatherMessage.textContent = data.message || 'ÎÇ†Ïî® Ï†ïÎ≥¥ ÏóÜÏùå';
                weatherTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayAirQualityData(data) {
            if (data && data.success && data.data) {
                const air = data.data;
                airQualityContent.innerHTML = `
                    <p><strong>ÎØ∏ÏÑ∏Î®ºÏßÄ(PM10):</strong> ${air.pm10 !== null ? air.pm10 + '¬µg/m¬≥' : 'Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                    <p><strong>Ï¥àÎØ∏ÏÑ∏Î®ºÏßÄ(PM2.5):</strong> ${air.pm25 !== null ? air.pm25 + '¬µg/m¬≥' : 'Ï†ïÎ≥¥ ÏóÜÏùå'}</p>
                    <p><strong>ÏÉÅÌÉú:</strong> ${air.status}</p>
                    ${air.stationName ? `<p><strong>Ï∏°Ï†ïÏÜå:</strong> ${air.stationName}</p>` : ''}
                `;
                airQualityMessage.textContent = air.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                airQualityTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${air.dataTime || air.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                airQualityContent.innerHTML = `<p>ÎåÄÍ∏∞Ïßà Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                airQualityMessage.textContent = data.message || 'ÎåÄÍ∏∞Ïßà Ï†ïÎ≥¥ ÏóÜÏùå';
                airQualityTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayCombinedData(data) {
            if (data && data.success && data.data) {
                const combined = data.data;
                let factorsHtml = '<ul>';
                if (combined.factors && combined.factors.length > 0) {
                    combined.factors.forEach(factor => {
                        factorsHtml += `<li>${factor}</li>`;
                    });
                } else {
                    factorsHtml += '<li>Ï∂îÏ≤ú ÏöîÏù∏ Ï†ïÎ≥¥ ÏóÜÏùå</li>';
                }
                factorsHtml += '</ul>';

                combinedContent.innerHTML = `
                    <p><strong>Ï¢ÖÌï© Ï†êÏàò:</strong> ${combined.score}Ï†ê</p>
                    <p><strong>Ïó¨Ìñâ Îì±Í∏â:</strong> ${combined.grade}</p>
                    <p><strong>Ï∂îÏ≤ú ÏÉÅÌÉú:</strong> ${combined.recommendation}</p>
                    <p><strong>Ï£ºÏöî ÏöîÏù∏:</strong></p>
                    ${factorsHtml}
                `;
                combinedMessage.textContent = combined.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                combinedTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${combined.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                combinedContent.innerHTML = `<p>Ï¢ÖÌï© Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                combinedMessage.textContent = data.message || 'Ï¢ÖÌï© Ï†ïÎ≥¥ ÏóÜÏùå';
                combinedTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }
        
        function renderFestivals(festivalsToRender) {
            if (!festivalsToRender || festivalsToRender.length === 0) {
                festivalsContent.innerHTML = '<p>Ìï¥Îãπ Ï°∞Í±¥Ïùò Ï∂ïÏ†úÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            festivalsContent.innerHTML = festivalsToRender.map(festival => `
                <div class="festival-item">
                    ${festival.image ? `<img src="${festival.image}" alt="${festival.title}" onerror="this.style.display='none';">` : '<div style="height:150px; background:#eee; display:flex; align-items:center; justify-content:center; color:#aaa; border-radius:6px; margin-bottom:10px;">Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</div>'}
                    <h4>${festival.title}</h4>
                    <p><strong>Ïû•ÏÜå:</strong> ${festival.location}</p>
                    <p><strong>Í∏∞Í∞Ñ:</strong> ${festival.startDate} ~ ${festival.endDate}</p>
                    ${festival.tel ? `<p><strong>Î¨∏Ïùò:</strong> ${festival.tel}</p>` : ''}
                    <p class="days-left">${festival.daysLeft}</p>
                    <p><strong>ÏÉÅÌÉú:</strong> <span class="status-${festival.status}">${festival.status === 'ongoing' ? 'ÏßÑÌñâÏ§ë' : 'ÏòàÏ†ï'}</span></p>
                </div>
            `).join('');
        }

        function displayFestivalData(data) {
            festivalDataCache = null; // Ï∫êÏãú Ï¥àÍ∏∞Ìôî
            if (data && data.success && data.data) {
                festivalDataCache = data.data; // ÏÉà Îç∞Ïù¥ÌÑ∞Î°ú Ï∫êÏãú ÏóÖÎç∞Ïù¥Ìä∏
                const stats = data.data.stats;
                festivalsStats.innerHTML = `
                    <p><strong>Ï¥ù Ï∂ïÏ†ú:</strong> ${stats.total}Í∞ú | 
                    <strong>ÏßÑÌñâ Ï§ë:</strong> ${stats.ongoing}Í∞ú | 
                    <strong>ÏòàÏ†ï:</strong> ${stats.upcoming}Í∞ú |
                    <strong>Ïù¥Î≤à Ï£ºÎßê:</strong> ${stats.thisWeekend}Í∞ú</p>
                `;
                
                // ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêú ÌÉ≠ Í∏∞Ï§ÄÏúºÎ°ú Ï∂ïÏ†ú Î™©Î°ù Î†åÎçîÎßÅ
                let festivalsToDisplay;
                if (currentFestivalTab === 'ongoing') festivalsToDisplay = data.data.ongoing;
                else if (currentFestivalTab === 'upcoming') festivalsToDisplay = data.data.upcoming;
                else if (currentFestivalTab === 'thisWeekend') festivalsToDisplay = data.data.thisWeekend;
                
                renderFestivals(festivalsToDisplay);

                festivalsMainMessage.textContent = data.data.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                festivalsTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${data.data.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                festivalsContent.innerHTML = `<p>Ï∂ïÏ†ú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                festivalsStats.innerHTML = '';
                festivalsMainMessage.textContent = data.message || (data.data && data.data.message) || 'Ï∂ïÏ†ú Ï†ïÎ≥¥ ÏóÜÏùå';
                festivalsTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        festivalTabs.addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                document.querySelectorAll('.festival-tabs button').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                currentFestivalTab = event.target.dataset.tab;
                
                if (festivalDataCache) { // Ï∫êÏãúÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©
                    let festivalsToDisplay;
                    if (currentFestivalTab === 'ongoing') festivalsToDisplay = festivalDataCache.ongoing;
                    else if (currentFestivalTab === 'upcoming') festivalsToDisplay = festivalDataCache.upcoming;
                    else if (currentFestivalTab === 'thisWeekend') festivalsToDisplay = festivalDataCache.thisWeekend;
                    renderFestivals(festivalsToDisplay);
                } else {
                    // Ï∫êÏãúÍ∞Ä ÏóÜÏúºÎ©¥ (Ïòà: ÌéòÏù¥ÏßÄ Ï≤´ Î°úÎìú Ïãú ÎòêÎäî Ïò§Î•ò ÌõÑ) Îã§Ïãú Î°úÎìú ÏãúÎèÑ (ÌïòÏßÄÎßå Í∏∞Î≥∏Ï†ÅÏúºÎ°úÎäî displayFestivalDataÏóêÏÑú Ï≤òÎ¶¨)
                    festivalsContent.innerHTML = '<p>Ï∂ïÏ†ú Îç∞Ïù¥ÌÑ∞Î•º Îã§Ïãú Î∂àÎü¨ÏôÄÏ£ºÏÑ∏Ïöî.</p>';
                }
            }
        });


        function displayTourismData(data) {
            if (data && data.success && data.data) {
                const tourism = data.data;
                let attractionsHtml = '<h3>Ï£ºÏöî Í¥ÄÍ¥ëÏßÄ</h3>';
                if (tourism.attractions && tourism.attractions.length > 0) {
                    attractionsHtml += '<ul>';
                    tourism.attractions.forEach(attr => {
                        attractionsHtml += `
                            <li>
                                <strong>${attr.title}</strong> (${attr.category})
                                ${attr.address ? `<br><small>${attr.address}</small>` : ''}
                                ${attr.tel ? `<br><small>Î¨∏Ïùò: ${attr.tel}</small>` : ''}
                            </li>`;
                    });
                    attractionsHtml += '</ul>';
                } else {
                    attractionsHtml += '<p>Ï∂îÏ≤ú Í¥ÄÍ¥ëÏßÄ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }

                let eventsHtml = '<h3>Ï£ºÏöî Ïù¥Î≤§Ìä∏ (ÏÉòÌîå)</h3>';
                 if (tourism.events && tourism.events.length > 0) {
                    eventsHtml += '<ul>';
                    tourism.events.forEach(event => {
                        eventsHtml += `<li><strong>${event.title}</strong> - ${event.location} (ÏòàÏÉÅÏùº: ${event.date || 'ÎØ∏Ï†ï'})</li>`;
                    });
                    eventsHtml += '</ul>';
                } else {
                    eventsHtml += '<p>Ïù¥Î≤§Ìä∏ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }

                tourismContent.innerHTML = attractionsHtml + eventsHtml;
                tourismMessage.textContent = tourism.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                tourismTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${tourism.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                tourismContent.innerHTML = `<p>Í¥ÄÍ¥ë Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                tourismMessage.textContent = data.message || 'Í¥ÄÍ¥ë Ï†ïÎ≥¥ ÏóÜÏùå';
                tourismTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayRankingData(data) {
            if (data && data.success && data.data) {
                const ranking = data.data;
                if (ranking.length > 0) {
                    let tableHtml = '<table class="ranking-table"><thead><tr><th>ÏàúÏúÑ</th><th>ÏßÄÏó≠</th><th>Ï†êÏàò</th><th>Îì±Í∏â</th><th>ÎÇ†Ïî®</th><th>ÎåÄÍ∏∞Ïßà</th><th>Ï£ºÏöî ÏöîÏù∏</th></tr></thead><tbody>';
                    ranking.forEach(item => {
                        tableHtml += `
                            <tr>
                                <td class="rank">${item.rank}</td>
                                <td>${item.region}</td>
                                <td class="score">${item.score}</td>
                                <td>${item.grade}</td>
                                <td>${item.weather}</td>
                                <td>${item.airQuality}</td>
                                <td>${item.factors.join(', ') || 'Ï†ïÎ≥¥ ÏóÜÏùå'}</td>
                            </tr>
                        `;
                    });
                    tableHtml += '</tbody></table>';
                    rankingContent.innerHTML = tableHtml;
                } else {
                    rankingContent.innerHTML = '<p>Îû≠ÌÇπ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }
                rankingMessage.textContent = data.message || 'Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏÑ±Í≥µ';
                rankingTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${data.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                rankingContent.innerHTML = `<p>Îû≠ÌÇπ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>`;
                rankingMessage.textContent = data.message || 'Îû≠ÌÇπ Ï†ïÎ≥¥ ÏóÜÏùå';
                rankingTime.textContent = `ÏóÖÎç∞Ïù¥Ìä∏: ${new Date().toLocaleString('ko-KR')}`;
            }
        }


        async function loadAllDataForRegion(region) {
            currentRegionTitle.textContent = region;
            festivalRegionTitle.textContent = region;
            tourismRegionTitle.textContent = region;

            // Î™®Îì† ÏÑπÏÖò Ï¥àÍ∏∞Ìôî
            weatherContent.innerHTML = '<p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            airQualityContent.innerHTML = '<p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            combinedContent.innerHTML = '<p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            festivalsContent.innerHTML = '<p>Ï∂ïÏ†ú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            festivalsStats.innerHTML = '';
            tourismContent.innerHTML = '<p>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            // Îû≠ÌÇπÏùÄ ÏßÄÏó≠Î≥ÑÎ°ú Îã§Ïãú Î°úÎìúÌïòÏßÄ ÏïäÏùå (Ï†ÑÏ≤¥ Îû≠ÌÇπ)

            const weatherData = await fetchData('weather', { region });
            displayWeatherData(weatherData);

            const airQualityData = await fetchData('air-quality', { region });
            displayAirQualityData(airQualityData);
            
            const combinedData = await fetchData('combined', { region });
            displayCombinedData(combinedData);

            const festivalData = await fetchData('festivals', { region }); // ÏßÄÏó≠Î≥Ñ Ï∂ïÏ†ú
            displayFestivalData(festivalData);

            const tourismData = await fetchData('tourism', { region });
            displayTourismData(tourismData);
            
            // Îû≠ÌÇπ Îç∞Ïù¥ÌÑ∞Îäî ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ìïú Î≤àÎßå ÎòêÎäî ÌïÑÏöî Ïãú Î≥ÑÎèÑ Î°úÎìú
            // Ïó¨Í∏∞ÏÑúÎäî ÏßÄÏó≠ Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ Îû≠ÌÇπÏùÑ Îã§Ïãú Î°úÎìúÌïòÏßÄ ÏïäÎèÑÎ°ù Ï≤òÎ¶¨ (Ïù¥ÎØ∏ Ï†ÑÏ≤¥ Îû≠ÌÇπÏù¥ÎØÄÎ°ú)
            // ÎßåÏïΩ ÏßÄÏó≠Î≥Ñ Îû≠ÌÇπÏù¥ ÌïÑÏöîÌïòÎã§Î©¥ ranking APIÎèÑ region ÌååÎùºÎØ∏ÌÑ∞Î•º Î∞õÎèÑÎ°ù ÏàòÏ†ï ÌïÑÏöî
        }
        
        async function loadInitialRanking() {
            rankingContent.innerHTML = '<p>Îû≠ÌÇπ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</p>';
            const rankingData = await fetchData('ranking');
            displayRankingData(rankingData);
        }


        regionSelect.addEventListener('change', (event) => {
            const selectedRegion = event.target.value;
            loadAllDataForRegion(selectedRegion);
        });

        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        document.addEventListener('DOMContentLoaded', () => {
            if (VERCEL_BASE_URL === 'https://healingk.vercel.app/api') {
                 showError("Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏÑ§Ï†ï Ïò§Î•ò: VERCEL_BASE_URLÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî. Í∞úÎ∞úÏûêÏóêÍ≤å Î¨∏ÏùòÌïòÍ±∞ÎÇò ÏΩîÎìú ÎÇ¥ Ìï¥Îãπ Î≥ÄÏàòÎ•º ÏàòÏ†ïÌï¥Ïïº Ìï©ÎãàÎã§.");
                 // Î°úÎçî Ïà®Í∏∞Í∏∞
                 hideLoader();
                 return; 
            }
            const initialRegion = regionSelect.value;
            loadAllDataForRegion(initialRegion);
            loadInitialRanking(); // Îû≠ÌÇπÏùÄ Ï¥àÍ∏∞Ïóê Ìïú Î≤à Î°úÎìú
        });

    </script>
</body>
</html>
