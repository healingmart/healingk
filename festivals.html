<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íë§K - ì‹¤ì‹œê°„ ì¶•ì œ ë° ê´€ê´‘ ì •ë³´</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #6D9FFF; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
            --secondary-color: #FFD6A5; /* íŒŒìŠ¤í…” ì˜¤ë Œì§€ */
            --accent-color: #C8E6C9; /* íŒŒìŠ¤í…” ê·¸ë¦° */
            --text-color: #333;
            --bg-color: #FFFFFF;
            --container-bg-color: #F8F9FA;
            --border-color: #E0E0E0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --font-family: 'Noto Sans KR', sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            background-color: var(--container-bg-color);
            border-radius: 12px;
            box-shadow: 0 8px 16px var(--shadow-color);
            padding: 25px;
            transition: all 0.3s ease-in-out;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .region-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .region-selector label {
            font-size: 1.1em;
            font-weight: 500;
        }

        .region-selector select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 1em;
            background-color: var(--bg-color);
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .region-selector select:hover, .region-selector select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(109, 159, 255, 0.2);
        }


        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .info-card {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
        }

        .info-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }

        .info-card h2 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.6em;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
        }
        
        .info-card h3 {
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-card p, .info-card li {
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .info-card strong {
            font-weight: 500;
        }

        .festival-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .festival-tabs button {
            padding: 10px 18px;
            border: none;
            background-color: transparent;
            color: var(--text-color);
            cursor: pointer;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }

        .festival-tabs button.active, .festival-tabs button:hover {
            background-color: var(--primary-color);
            color: var(--bg-color);
        }

        .festival-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .festival-item {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px var(--shadow-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .festival-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.12);
        }

        .festival-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
            background-color: #eee; /* Placeholder bg */
        }
        .festival-item h4 {
            margin: 0 0 5px 0;
            color: var(--primary-color);
            font-size: 1.1em;
        }
        .festival-item p {
            font-size: 0.85em;
            margin-bottom: 5px;
            color: #555;
        }
        .festival-item .days-left {
            font-weight: bold;
            color: var(--secondary-color);
        }
         .festival-item .status-ongoing { color: #4CAF50; font-weight: bold; }
        .festival-item .status-upcoming { color: #FF9800; font-weight: bold; }


        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .ranking-table th, .ranking-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .ranking-table th {
            background-color: var(--accent-color);
            color: var(--text-color);
            font-weight: 500;
        }
        .ranking-table tr:hover {
            background-color: #f1f1f1;
        }
        .ranking-table .rank { font-weight: bold; color: var(--primary-color); }
        .ranking-table .score { font-weight: bold; }

        .loader {
            display: none; /* Hidden by default */
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid var(--primary-color); /* Blue */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            z-index: 1000;
        }
        
        .error-message {
            color: red;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background-color: #ffebee;
            border: 1px solid red;
            border-radius: 6px;
            margin-top: 15px;
        }

        .api-message {
            font-size: 0.85em;
            color: #757575;
            margin-top: 5px;
            text-align: right;
        }
        
        .data-time {
            font-size: 0.8em;
            color: #888;
            margin-top: 3px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 0.9em;
            color: #777;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-container { padding: 15px; }
            header h1 { font-size: 2em; }
            .info-card h2 { font-size: 1.4em; }
            .festival-tabs button { padding: 8px 12px; font-size: 0.9em; }
        }

    </style>
</head>
<body>
    <div class="loader" id="loader"></div>

    <div class="app-container">
        <header>
            <h1>íë§K ì •ë³´ ì„œë¹„ìŠ¤</h1>
            <p>ëŒ€í•œë¯¼êµ­ì˜ ì‹¤ì‹œê°„ ë‚ ì”¨, ëŒ€ê¸°ì§ˆ, ì¶•ì œ, ê´€ê´‘ ì •ë³´ë¥¼ í•œëˆˆì—!</p>
        </header>

        <div class="region-selector">
            <label for="region">ì§€ì—­ ì„ íƒ:</label>
            <select id="region">
                <option value="ì„œìš¸">ì„œìš¸</option>
                <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                <option value="ì œì£¼">ì œì£¼</option>
                <option value="ê°•ë¦‰">ê°•ë¦‰</option>
                <option value="ì „ì£¼">ì „ì£¼</option>
                <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
                <option value="ê´‘ì£¼">ê´‘ì£¼</option>
                <option value="ëŒ€ì „">ëŒ€ì „</option>
            </select>
        </div>

        <div id="error-display" class="error-message" style="display: none;"></div>
        
        <section id="combined-info-section" class="info-card">
            <h2><span id="current-region-title">ì„œìš¸</span> ì¢…í•© ì •ë³´ ğŸŒŸ</h2>
            <div id="combined-content">
                <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
            <p class="api-message" id="combined-message"></p>
            <p class="data-time" id="combined-time"></p>
        </section>

        <div class="info-grid">
            <section id="weather-section" class="info-card">
                <h2>ë‚ ì”¨ ğŸŒ¤ï¸</h2>
                <div id="weather-content">
                    <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
                <p class="api-message" id="weather-message"></p>
                <p class="data-time" id="weather-time"></p>
            </section>

            <section id="air-quality-section" class="info-card">
                <h2>ëŒ€ê¸°ì§ˆ ğŸŒ¬ï¸</h2>
                <div id="air-quality-content">
                    <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
                <p class="api-message" id="air-quality-message"></p>
                <p class="data-time" id="air-quality-time"></p>
            </section>
        </div>
        
        <section id="festivals-section" class="info-card">
            <h2>ì¶•ì œ ì •ë³´ ğŸª (<span id="festival-region-title">ì„œìš¸</span>)</h2>
            <div class="festival-tabs">
                <button class="active" data-tab="ongoing">ì§„í–‰ ì¤‘</button>
                <button data-tab="upcoming">ì˜ˆì •</button>
                <button data-tab="thisWeekend">ì´ë²ˆ ì£¼ë§</button>
            </div>
            <div id="festivals-stats" style="margin-bottom: 10px; font-size: 0.9em;"></div>
            <div id="festivals-content" class="festival-list">
                <p>ì¶•ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
             <p class="api-message" id="festivals-main-message"></p>
             <p class="data-time" id="festivals-time"></p>
        </section>

        <section id="tourism-section" class="info-card">
            <h2>ì£¼ìš” ê´€ê´‘ì§€ ë° ì´ë²¤íŠ¸ ğŸ›ï¸ (<span id="tourism-region-title">ì„œìš¸</span>)</h2>
            <div id="tourism-content">
                <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
            <p class="api-message" id="tourism-message"></p>
            <p class="data-time" id="tourism-time"></p>
        </section>

        <section id="ranking-section" class="info-card">
            <h2>ê´€ê´‘ì§€ ë­í‚¹ ğŸ†</h2>
            <div id="ranking-content">
                <p>ë­í‚¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
            <p class="api-message" id="ranking-message"></p>
            <p class="data-time" id="ranking-time"></p>
        </section>

        <footer>
            <p>&copy; <span id="current-year"></span> íë§K í”„ë¡œì íŠ¸. All rights reserved.</p>
            <p>ë°ì´í„° ì œê³µ: í•œêµ­ê´€ê´‘ê³µì‚¬, ê¸°ìƒì²­, ì—ì–´ì½”ë¦¬ì•„ ë“±</p>
            <p>ë³¸ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´ëŠ” ì‹¤ì œì™€ ë‹¤ì†Œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </footer>
    </div>

    <script>
        // ì¤‘ìš”: ì´ URLì„ ì‹¤ì œ Vercel ë°°í¬ URLë¡œ ë³€ê²½í•˜ì„¸ìš”. (ì˜ˆ: https://your-project-name.vercel.app)
        const VERCEL_BASE_URL = 'https://healingk.vercel.app/api'; // <--- ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”!!!

        const loader = document.getElementById('loader');
        const errorDisplay = document.getElementById('error-display');

        const regionSelect = document.getElementById('region');
        
        const currentRegionTitle = document.getElementById('current-region-title');
        const festivalRegionTitle = document.getElementById('festival-region-title');
        const tourismRegionTitle = document.getElementById('tourism-region-title');

        const weatherContent = document.getElementById('weather-content');
        const weatherMessage = document.getElementById('weather-message');
        const weatherTime = document.getElementById('weather-time');

        const airQualityContent = document.getElementById('air-quality-content');
        const airQualityMessage = document.getElementById('air-quality-message');
        const airQualityTime = document.getElementById('air-quality-time');

        const combinedContent = document.getElementById('combined-content');
        const combinedMessage = document.getElementById('combined-message');
        const combinedTime = document.getElementById('combined-time');

        const festivalsContent = document.getElementById('festivals-content');
        const festivalsStats = document.getElementById('festivals-stats');
        const festivalsMainMessage = document.getElementById('festivals-main-message');
        const festivalsTime = document.getElementById('festivals-time');
        const festivalTabs = document.querySelector('.festival-tabs');
        let currentFestivalTab = 'ongoing';
        let festivalDataCache = null; // ì¶•ì œ ë°ì´í„° ìºì‹±ìš©

        const tourismContent = document.getElementById('tourism-content');
        const tourismMessage = document.getElementById('tourism-message');
        const tourismTime = document.getElementById('tourism-time');
        
        const rankingContent = document.getElementById('ranking-content');
        const rankingMessage = document.getElementById('ranking-message');
        const rankingTime = document.getElementById('ranking-time');

        document.getElementById('current-year').textContent = new Date().getFullYear();

        function showLoader() {
            loader.style.display = 'block';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }
        
        function showError(message) {
            errorDisplay.textContent = message;
            errorDisplay.style.display = 'block';
        }

        function clearError() {
            errorDisplay.textContent = '';
            errorDisplay.style.display = 'none';
        }

        async function fetchData(endpoint, params = {}) {
            if (VERCEL_BASE_URL === 'https://healingk.vercel.app/api') {
                console.error("VERCEL_BASE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ì˜ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.");
                showError("ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì˜¤ë¥˜: VERCEL_BASE_URLì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                // ëª¨ë“  ì»¨í…ì¸  ì˜ì—­ì— ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                const placeholderText = "ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì˜¤ë¥˜ì…ë‹ˆë‹¤.";
                weatherContent.innerHTML = `<p>${placeholderText}</p>`;
                airQualityContent.innerHTML = `<p>${placeholderText}</p>`;
                combinedContent.innerHTML = `<p>${placeholderText}</p>`;
                festivalsContent.innerHTML = `<p>${placeholderText}</p>`;
                tourismContent.innerHTML = `<p>${placeholderText}</p>`;
                rankingContent.innerHTML = `<p>${placeholderText}</p>`;
                return null;
            }
            
            showLoader();
            clearError();
            
            const queryParams = new URLSearchParams(params).toString();
            const url = `${VERCEL_BASE_URL}/api/${endpoint}${queryParams ? '?' + queryParams : ''}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                hideLoader();
                return data;
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                showError(`ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ (${endpoint}): ${error.message}`);
                hideLoader();
                return { success: false, message: `í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜¤ë¥˜: ${error.message}` }; // API ì‘ë‹µ í˜•ì‹ì— ë§ê²Œ ë°˜í™˜
            }
        }

        function displayWeatherData(data) {
            if (data && data.success && data.data) {
                const weather = data.data;
                weatherContent.innerHTML = `
                    <p><strong>ì˜¨ë„:</strong> ${weather.temperature}Â°C</p>
                    <p><strong>í•˜ëŠ˜:</strong> ${weather.sky}</p>
                    <p><strong>ê°•ìˆ˜:</strong> ${weather.precipitation || 'ì •ë³´ ì—†ìŒ'}</p>
                `;
                weatherMessage.textContent = weather.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                weatherTime.textContent = `ì—…ë°ì´íŠ¸: ${weather.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                weatherContent.innerHTML = `<p>ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                weatherMessage.textContent = data.message || 'ë‚ ì”¨ ì •ë³´ ì—†ìŒ';
                weatherTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayAirQualityData(data) {
            if (data && data.success && data.data) {
                const air = data.data;
                airQualityContent.innerHTML = `
                    <p><strong>ë¯¸ì„¸ë¨¼ì§€(PM10):</strong> ${air.pm10 !== null ? air.pm10 + 'Âµg/mÂ³' : 'ì •ë³´ ì—†ìŒ'}</p>
                    <p><strong>ì´ˆë¯¸ì„¸ë¨¼ì§€(PM2.5):</strong> ${air.pm25 !== null ? air.pm25 + 'Âµg/mÂ³' : 'ì •ë³´ ì—†ìŒ'}</p>
                    <p><strong>ìƒíƒœ:</strong> ${air.status}</p>
                    ${air.stationName ? `<p><strong>ì¸¡ì •ì†Œ:</strong> ${air.stationName}</p>` : ''}
                `;
                airQualityMessage.textContent = air.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                airQualityTime.textContent = `ì—…ë°ì´íŠ¸: ${air.dataTime || air.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                airQualityContent.innerHTML = `<p>ëŒ€ê¸°ì§ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                airQualityMessage.textContent = data.message || 'ëŒ€ê¸°ì§ˆ ì •ë³´ ì—†ìŒ';
                airQualityTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayCombinedData(data) {
            if (data && data.success && data.data) {
                const combined = data.data;
                let factorsHtml = '<ul>';
                if (combined.factors && combined.factors.length > 0) {
                    combined.factors.forEach(factor => {
                        factorsHtml += `<li>${factor}</li>`;
                    });
                } else {
                    factorsHtml += '<li>ì¶”ì²œ ìš”ì¸ ì •ë³´ ì—†ìŒ</li>';
                }
                factorsHtml += '</ul>';

                combinedContent.innerHTML = `
                    <p><strong>ì¢…í•© ì ìˆ˜:</strong> ${combined.score}ì </p>
                    <p><strong>ì—¬í–‰ ë“±ê¸‰:</strong> ${combined.grade}</p>
                    <p><strong>ì¶”ì²œ ìƒíƒœ:</strong> ${combined.recommendation}</p>
                    <p><strong>ì£¼ìš” ìš”ì¸:</strong></p>
                    ${factorsHtml}
                `;
                combinedMessage.textContent = combined.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                combinedTime.textContent = `ì—…ë°ì´íŠ¸: ${combined.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                combinedContent.innerHTML = `<p>ì¢…í•© ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                combinedMessage.textContent = data.message || 'ì¢…í•© ì •ë³´ ì—†ìŒ';
                combinedTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }
        
        function renderFestivals(festivalsToRender) {
            if (!festivalsToRender || festivalsToRender.length === 0) {
                festivalsContent.innerHTML = '<p>í•´ë‹¹ ì¡°ê±´ì˜ ì¶•ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            festivalsContent.innerHTML = festivalsToRender.map(festival => `
                <div class="festival-item">
                    ${festival.image ? `<img src="${festival.image}" alt="${festival.title}" onerror="this.style.display='none';">` : '<div style="height:150px; background:#eee; display:flex; align-items:center; justify-content:center; color:#aaa; border-radius:6px; margin-bottom:10px;">ì´ë¯¸ì§€ ì—†ìŒ</div>'}
                    <h4>${festival.title}</h4>
                    <p><strong>ì¥ì†Œ:</strong> ${festival.location}</p>
                    <p><strong>ê¸°ê°„:</strong> ${festival.startDate} ~ ${festival.endDate}</p>
                    ${festival.tel ? `<p><strong>ë¬¸ì˜:</strong> ${festival.tel}</p>` : ''}
                    <p class="days-left">${festival.daysLeft}</p>
                    <p><strong>ìƒíƒœ:</strong> <span class="status-${festival.status}">${festival.status === 'ongoing' ? 'ì§„í–‰ì¤‘' : 'ì˜ˆì •'}</span></p>
                </div>
            `).join('');
        }

        function displayFestivalData(data) {
            festivalDataCache = null; // ìºì‹œ ì´ˆê¸°í™”
            if (data && data.success && data.data) {
                festivalDataCache = data.data; // ìƒˆ ë°ì´í„°ë¡œ ìºì‹œ ì—…ë°ì´íŠ¸
                const stats = data.data.stats;
                festivalsStats.innerHTML = `
                    <p><strong>ì´ ì¶•ì œ:</strong> ${stats.total}ê°œ | 
                    <strong>ì§„í–‰ ì¤‘:</strong> ${stats.ongoing}ê°œ | 
                    <strong>ì˜ˆì •:</strong> ${stats.upcoming}ê°œ |
                    <strong>ì´ë²ˆ ì£¼ë§:</strong> ${stats.thisWeekend}ê°œ</p>
                `;
                
                // í˜„ì¬ í™œì„±í™”ëœ íƒ­ ê¸°ì¤€ìœ¼ë¡œ ì¶•ì œ ëª©ë¡ ë Œë”ë§
                let festivalsToDisplay;
                if (currentFestivalTab === 'ongoing') festivalsToDisplay = data.data.ongoing;
                else if (currentFestivalTab === 'upcoming') festivalsToDisplay = data.data.upcoming;
                else if (currentFestivalTab === 'thisWeekend') festivalsToDisplay = data.data.thisWeekend;
                
                renderFestivals(festivalsToDisplay);

                festivalsMainMessage.textContent = data.data.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                festivalsTime.textContent = `ì—…ë°ì´íŠ¸: ${data.data.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                festivalsContent.innerHTML = `<p>ì¶•ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                festivalsStats.innerHTML = '';
                festivalsMainMessage.textContent = data.message || (data.data && data.data.message) || 'ì¶•ì œ ì •ë³´ ì—†ìŒ';
                festivalsTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        festivalTabs.addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                document.querySelectorAll('.festival-tabs button').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                currentFestivalTab = event.target.dataset.tab;
                
                if (festivalDataCache) { // ìºì‹œëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
                    let festivalsToDisplay;
                    if (currentFestivalTab === 'ongoing') festivalsToDisplay = festivalDataCache.ongoing;
                    else if (currentFestivalTab === 'upcoming') festivalsToDisplay = festivalDataCache.upcoming;
                    else if (currentFestivalTab === 'thisWeekend') festivalsToDisplay = festivalDataCache.thisWeekend;
                    renderFestivals(festivalsToDisplay);
                } else {
                    // ìºì‹œê°€ ì—†ìœ¼ë©´ (ì˜ˆ: í˜ì´ì§€ ì²« ë¡œë“œ ì‹œ ë˜ëŠ” ì˜¤ë¥˜ í›„) ë‹¤ì‹œ ë¡œë“œ ì‹œë„ (í•˜ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œëŠ” displayFestivalDataì—ì„œ ì²˜ë¦¬)
                    festivalsContent.innerHTML = '<p>ì¶•ì œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.</p>';
                }
            }
        });


        function displayTourismData(data) {
            if (data && data.success && data.data) {
                const tourism = data.data;
                let attractionsHtml = '<h3>ì£¼ìš” ê´€ê´‘ì§€</h3>';
                if (tourism.attractions && tourism.attractions.length > 0) {
                    attractionsHtml += '<ul>';
                    tourism.attractions.forEach(attr => {
                        attractionsHtml += `
                            <li>
                                <strong>${attr.title}</strong> (${attr.category})
                                ${attr.address ? `<br><small>${attr.address}</small>` : ''}
                                ${attr.tel ? `<br><small>ë¬¸ì˜: ${attr.tel}</small>` : ''}
                            </li>`;
                    });
                    attractionsHtml += '</ul>';
                } else {
                    attractionsHtml += '<p>ì¶”ì²œ ê´€ê´‘ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

                let eventsHtml = '<h3>ì£¼ìš” ì´ë²¤íŠ¸ (ìƒ˜í”Œ)</h3>';
                 if (tourism.events && tourism.events.length > 0) {
                    eventsHtml += '<ul>';
                    tourism.events.forEach(event => {
                        eventsHtml += `<li><strong>${event.title}</strong> - ${event.location} (ì˜ˆìƒì¼: ${event.date || 'ë¯¸ì •'})</li>`;
                    });
                    eventsHtml += '</ul>';
                } else {
                    eventsHtml += '<p>ì´ë²¤íŠ¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

                tourismContent.innerHTML = attractionsHtml + eventsHtml;
                tourismMessage.textContent = tourism.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                tourismTime.textContent = `ì—…ë°ì´íŠ¸: ${tourism.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                tourismContent.innerHTML = `<p>ê´€ê´‘ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                tourismMessage.textContent = data.message || 'ê´€ê´‘ ì •ë³´ ì—†ìŒ';
                tourismTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }

        function displayRankingData(data) {
            if (data && data.success && data.data) {
                const ranking = data.data;
                if (ranking.length > 0) {
                    let tableHtml = '<table class="ranking-table"><thead><tr><th>ìˆœìœ„</th><th>ì§€ì—­</th><th>ì ìˆ˜</th><th>ë“±ê¸‰</th><th>ë‚ ì”¨</th><th>ëŒ€ê¸°ì§ˆ</th><th>ì£¼ìš” ìš”ì¸</th></tr></thead><tbody>';
                    ranking.forEach(item => {
                        tableHtml += `
                            <tr>
                                <td class="rank">${item.rank}</td>
                                <td>${item.region}</td>
                                <td class="score">${item.score}</td>
                                <td>${item.grade}</td>
                                <td>${item.weather}</td>
                                <td>${item.airQuality}</td>
                                <td>${item.factors.join(', ') || 'ì •ë³´ ì—†ìŒ'}</td>
                            </tr>
                        `;
                    });
                    tableHtml += '</tbody></table>';
                    rankingContent.innerHTML = tableHtml;
                } else {
                    rankingContent.innerHTML = '<p>ë­í‚¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                rankingMessage.textContent = data.message || 'ë°ì´í„° ë¡œë“œ ì„±ê³µ';
                rankingTime.textContent = `ì—…ë°ì´íŠ¸: ${data.time || new Date().toLocaleString('ko-KR')}`;
            } else {
                rankingContent.innerHTML = `<p>ë­í‚¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
                rankingMessage.textContent = data.message || 'ë­í‚¹ ì •ë³´ ì—†ìŒ';
                rankingTime.textContent = `ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;
            }
        }


        async function loadAllDataForRegion(region) {
            currentRegionTitle.textContent = region;
            festivalRegionTitle.textContent = region;
            tourismRegionTitle.textContent = region;

            // ëª¨ë“  ì„¹ì…˜ ì´ˆê¸°í™”
            weatherContent.innerHTML = '<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            airQualityContent.innerHTML = '<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            combinedContent.innerHTML = '<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            festivalsContent.innerHTML = '<p>ì¶•ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            festivalsStats.innerHTML = '';
            tourismContent.innerHTML = '<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            // ë­í‚¹ì€ ì§€ì—­ë³„ë¡œ ë‹¤ì‹œ ë¡œë“œí•˜ì§€ ì•ŠìŒ (ì „ì²´ ë­í‚¹)

            const weatherData = await fetchData('weather', { region });
            displayWeatherData(weatherData);

            const airQualityData = await fetchData('air-quality', { region });
            displayAirQualityData(airQualityData);
            
            const combinedData = await fetchData('combined', { region });
            displayCombinedData(combinedData);

            const festivalData = await fetchData('festivals', { region }); // ì§€ì—­ë³„ ì¶•ì œ
            displayFestivalData(festivalData);

            const tourismData = await fetchData('tourism', { region });
            displayTourismData(tourismData);
            
            // ë­í‚¹ ë°ì´í„°ëŠ” í˜ì´ì§€ ë¡œë“œ ì‹œ í•œ ë²ˆë§Œ ë˜ëŠ” í•„ìš” ì‹œ ë³„ë„ ë¡œë“œ
            // ì—¬ê¸°ì„œëŠ” ì§€ì—­ ë³€ê²½ ì‹œì—ë„ ë­í‚¹ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬ (ì´ë¯¸ ì „ì²´ ë­í‚¹ì´ë¯€ë¡œ)
            // ë§Œì•½ ì§€ì—­ë³„ ë­í‚¹ì´ í•„ìš”í•˜ë‹¤ë©´ ranking APIë„ region íŒŒë¼ë¯¸í„°ë¥¼ ë°›ë„ë¡ ìˆ˜ì • í•„ìš”
        }
        
        async function loadInitialRanking() {
            rankingContent.innerHTML = '<p>ë­í‚¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            const rankingData = await fetchData('ranking');
            displayRankingData(rankingData);
        }


        regionSelect.addEventListener('change', (event) => {
            const selectedRegion = event.target.value;
            loadAllDataForRegion(selectedRegion);
        });

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            if (VERCEL_BASE_URL === 'https://healingk.vercel.app/api') {
                 showError("ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì˜¤ë¥˜: VERCEL_BASE_URLì„ í™•ì¸í•´ì£¼ì„¸ìš”. ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ê±°ë‚˜ ì½”ë“œ ë‚´ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.");
                 // ë¡œë” ìˆ¨ê¸°ê¸°
                 hideLoader();
                 return; 
            }
            const initialRegion = regionSelect.value;
            loadAllDataForRegion(initialRegion);
            loadInitialRanking(); // ë­í‚¹ì€ ì´ˆê¸°ì— í•œ ë²ˆ ë¡œë“œ
        });

    </script>
</body>
</html>
