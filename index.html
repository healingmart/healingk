<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourism API Test - í”„ë¡œë•ì…˜ ìµœì¢…</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">ğŸ›ï¸ í•œêµ­ê´€ê´‘ê³µì‚¬ API í…ŒìŠ¤íŠ¸</h1>
            <p class="text-gray-600 mt-2">G3 í”„ë¡œë•ì…˜ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
        </header>

        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex flex-wrap justify-center items-center gap-4">
                <button onclick="testHealth()" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">â¤ï¸ í—¬ìŠ¤ì²´í¬</button>
                <button onclick="loadAll()" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">ğŸ›ï¸ ì „ì²´ ì¹´í…Œê³ ë¦¬ ë¡œë“œ</button>
                <button onclick="testSingle()" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed">ğŸ§ª ë‹¨ì¼ í…ŒìŠ¤íŠ¸</button>
                <button onclick="clearResults()" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition-transform transform hover:scale-105">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
            </div>
        </div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
        <div id="status-container" class="p-4 mb-6 rounded-lg text-center font-semibold" style="display:none;"></div>

        <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        <div id="results" class="space-y-8"></div>
    </div>

    <script>
        // --- API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì • ---
        // ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œëŠ” ê° ê¸°ëŠ¥(handler)ë³„ë¡œ ì—”ë“œí¬ì¸íŠ¸ê°€ ë¶„ë¦¬ë˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.
        // G3 ì½”ë“œì˜ `handler` í•¨ìˆ˜ëŠ” ì´ ì£¼ì†Œë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
        const TOURISM_API_ENDPOINT = '/api/tourism'; 
        // G3 ì½”ë“œì˜ `healthCheck` í•¨ìˆ˜ëŠ” ì´ ì£¼ì†Œë¡œ í˜¸ì¶œë©ë‹ˆë‹¤. (Vercel ë¼ìš°íŒ… ì„¤ì •ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŒ)
        const HEALTH_API_ENDPOINT = '/api/healthCheck';

        const categories = [
            {id:'12', name:'ê´€ê´‘ì§€', icon:'ğŸï¸'},
            {id:'14', name:'ë¬¸í™”ì‹œì„¤', icon:'ğŸ­'},
            {id:'15', name:'ì¶•ì œ/ê³µì—°/í–‰ì‚¬', icon:'ğŸª'},
            {id:'25', name:'ì—¬í–‰ì½”ìŠ¤', icon:'ğŸ—ºï¸'},
            {id:'28', name:'ë ˆí¬ì¸ ', icon:'â›·ï¸'},
            {id:'32', name:'ìˆ™ë°•', icon:'ğŸ¨'},
            {id:'38', name:'ì‡¼í•‘', icon:'ğŸ›ï¸'},
            {id:'39', name:'ìŒì‹ì ', icon:'ğŸ½ï¸'}
        ];
        
        const statusContainer = document.getElementById('status-container');
        const resultsContainer = document.getElementById('results');
        const buttons = document.querySelectorAll('button');

        /**
         * ë²„íŠ¼ í™œì„±/ë¹„í™œì„± ìƒíƒœë¥¼ ì œì–´í•©ë‹ˆë‹¤.
         * @param {boolean} isLoading - ë¡œë”© ì¤‘ ì—¬ë¶€
         */
        function setButtonsLoading(isLoading) {
            buttons.forEach(button => {
                button.disabled = isLoading;
            });
        }

        /**
         * ìƒíƒœ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {string} msg - í‘œì‹œí•  ë©”ì‹œì§€ (HTML ê°€ëŠ¥)
         * @param {'loading'|'success'|'error'} type - ë©”ì‹œì§€ ì¢…ë¥˜
         */
        function showStatus(msg, type = 'loading') {
            statusContainer.style.display = 'block';
            let bgColor, textColor;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                    break;
                case 'error':
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                    break;
                default: // loading
                    bgColor = 'bg-blue-100';
                    textColor = 'text-blue-800';
                    break;
            }
            statusContainer.className = `p-4 mb-6 rounded-lg text-center font-semibold ${bgColor} ${textColor}`;
            statusContainer.innerHTML = `<div class="flex justify-center items-center">${msg}</div>`;
        }

        /**
         * ë²”ìš© API í˜¸ì¶œ í•¨ìˆ˜ì…ë‹ˆë‹¤.
         * @param {string} endpoint - í˜¸ì¶œí•  API ì—”ë“œí¬ì¸íŠ¸
         * @param {object} params - ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡í•  ê°ì²´
         * @returns {Promise<any>} - API ì‘ë‹µ ë°ì´í„°
         */
        async function callApi(endpoint, params = {}) {
            const url = new URL(endpoint, location.origin);
            Object.entries(params).forEach(([key, value]) => {
                if (value !== undefined && value !== null) {
                    url.searchParams.set(key, value);
                }
            });

            const response = await fetch(url);
            const data = await response.json();

            if (!response.ok || !data.success) {
                // ì„œë²„ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì‚¬ìš©
                throw new Error(data.error?.message || `HTTP Error ${response.status}`);
            }
            return data;
        }
        
        /**
         * í—¬ìŠ¤ì²´í¬ APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
         */
        async function testHealth() {
            clearResults();
            setButtonsLoading(true);
            showStatus('<div class="loading-spinner w-5 h-5 border-blue-500 border-t-transparent border-2 rounded-full mr-3"></div>í—¬ìŠ¤ì²´í¬ ì¤‘...');
            try {
                // ìˆ˜ì •: 'healthCheck' ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.
                const data = await callApi(HEALTH_API_ENDPOINT);
                const checks = data.checks;
                const statusMessage = `âœ… í—¬ìŠ¤ì²´í¬ ì„±ê³µ! | API í‚¤: ${checks.apiKeyConfigured ? 'OK' : 'ëˆ„ë½!'} | ì»¨í…Œì´ë„ˆ: ${checks.serviceContainerInitialized ? 'OK' : 'ì‹¤íŒ¨!'}`;
                showStatus(statusMessage, 'success');
            } catch (e) {
                showStatus(`âŒ ì—°ê²° ì‹¤íŒ¨: ${e.message}`, 'error');
            } finally {
                setButtonsLoading(false);
            }
        }

        /**
         * ë‹¨ì¼ ì¹´í…Œê³ ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
         */
        async function testSingle() {
            clearResults();
            setButtonsLoading(true);
            showStatus('<div class="loading-spinner w-5 h-5 border-indigo-500 border-t-transparent border-2 rounded-full mr-3"></div>ë‹¨ì¼ í…ŒìŠ¤íŠ¸ ì¤‘...');
            try {
                const data = await callApi(TOURISM_API_ENDPOINT, { operation: 'areaBasedList', contentTypeId: '12', numOfRows: '5' });
                const items = data.data?.response?.body?.items?.item || [];
                showStatus(`âœ… ë‹¨ì¼ í…ŒìŠ¤íŠ¸ ì„±ê³µ! ${items.length}ê°œ ì•„ì´í…œ ë¡œë“œ`, 'success');
                showCategory({id:'12', name:'ê´€ê´‘ì§€ í…ŒìŠ¤íŠ¸', icon:'ğŸï¸'}, items, data.data.response.body.totalCount);
            } catch (e) {
                showStatus(`âŒ ë‹¨ì¼ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${e.message}`, 'error');
            } finally {
                setButtonsLoading(false);
            }
        }

        /**
         * ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
         */
        async function loadAll() {
            clearResults();
            setButtonsLoading(true);
            let totalItems = 0;
            let successCount = 0;

            for (let i = 0; i < categories.length; i++) {
                const cat = categories[i];
                showStatus(`<div class="loading-spinner w-5 h-5 border-green-500 border-t-transparent border-2 rounded-full mr-3"></div>(${i+1}/${categories.length}) ${cat.name} ë¡œë”© ì¤‘...`);
                
                try {
                    const data = await callApi(TOURISM_API_ENDPOINT, {
                        operation: 'areaBasedList',
                        contentTypeId: cat.id,
                        numOfRows: '30'
                    });
                    
                    const items = data.data?.response?.body?.items?.item || [];
                    const totalCount = data.data?.response?.body?.totalCount || 0;
                    showCategory(cat, items, totalCount);
                    totalItems += items.length;
                    successCount++;

                    // API Rate Limitì„ í”¼í•˜ê¸° ìœ„í•´ ìš”ì²­ ê°„ ë”œë ˆì´ ì¶”ê°€
                    if (i < categories.length - 1) await new Promise(r => setTimeout(r, 200));
                } catch(e) {
                    showError(cat, e.message);
                }
            }
            
            showStatus(`âœ… ë¡œë“œ ì™„ë£Œ! ${successCount}/${categories.length}ê°œ ì¹´í…Œê³ ë¦¬ì—ì„œ ì´ ${totalItems}ê°œ ë°ì´í„° ë¡œë“œ`, 'success');
            setButtonsLoading(false);
        }

        /**
         * ì¹´í…Œê³ ë¦¬ë³„ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {object} cat - ì¹´í…Œê³ ë¦¬ ì •ë³´
         * @param {Array} items - ì•„ì´í…œ ëª©ë¡
         * @param {number} totalCount - ì „ì²´ ì•„ì´í…œ ìˆ˜
         */
        function showCategory(cat, items, totalCount) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category bg-white rounded-xl shadow-md overflow-hidden';
            
            const itemsHtml = items.map(item => `
                <div class="item border border-gray-200 rounded-lg overflow-hidden bg-white hover:shadow-lg transition-shadow duration-300">
                    <img src="${item.firstimage || 'https://placehold.co/400x250/E2E8F0/A0AEC0?text=No+Image'}" 
                         onerror="this.onerror=null;this.src='https://placehold.co/400x250/E2E8F0/A0AEC0?text=Error';" 
                         class="w-full h-48 object-cover" alt="${item.title || ''}">
                    <div class="p-4">
                        <div class="font-bold text-lg mb-2 truncate" title="${item.title || ''}">${item.title || 'ì œëª©ì—†ìŒ'}</div>
                        <p class="text-gray-600 text-sm mb-2 truncate">ğŸ“ ${item.addr1 || 'ì£¼ì†Œì—†ìŒ'}</p>
                        <p class="text-gray-500 text-xs">ID: ${item.contentid}</p>
                    </div>
                </div>
            `).join('');

            categoryDiv.innerHTML = `
                <div class="category-header bg-gray-800 text-white p-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold">${cat.icon} ${cat.name}</h2>
                    <span class="text-sm bg-gray-600 px-2 py-1 rounded-full">${items.length} / ${totalCount}</span>
                </div>
                <div class="items p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    ${itemsHtml || '<p class="col-span-full text-center text-gray-500 py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
            `;
            resultsContainer.appendChild(categoryDiv);
        }

        /**
         * ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {object} cat - ì¹´í…Œê³ ë¦¬ ì •ë³´
         * @param {string} errorMsg - ì—ëŸ¬ ë©”ì‹œì§€
         */
        function showError(cat, errorMsg) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'category bg-red-50 rounded-xl shadow-md overflow-hidden';
            errorDiv.innerHTML = `
                <div class="category-header bg-red-700 text-white p-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold">${cat.icon} ${cat.name}</h2>
                    <span class="text-sm bg-red-500 px-2 py-1 rounded-full">ì˜¤ë¥˜ ë°œìƒ</span>
                </div>
                <div class="p-4 text-red-800 font-semibold">
                    âŒ ${errorMsg}
                </div>
            `;
            resultsContainer.appendChild(errorDiv);
        }

        /**
         * ê²°ê³¼ ì˜ì—­ê³¼ ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        function clearResults() {
            resultsContainer.innerHTML = '';
            statusContainer.style.display = 'none';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ í—¬ìŠ¤ì²´í¬ ì‹¤í–‰
        window.onload = () => testHealth();

    </script>
</body>
</html>
