<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관광 정보 API 테스트</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], select, textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover { background-color: #0056b3; }
        pre {
            background-color: #e9e9e9;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
        }
        .section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .section:last-child { border-bottom: none; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>관광 정보 API 테스트 클라이언트</h1>

        <div class="section">
            <h2>API 엔드포인트 설정</h2>
            <label for="apiEndpoint">API URL:</label>
            <input type="text" id="apiEndpoint" value="YOUR_SERVERLESS_FUNCTION_URL_HERE" placeholder="예: https://your-vercel-project.vercel.app/api/tourism">
            <p style="font-size: 0.9em; color: #777;">실제 배포된 서버리스 함수의 URL을 입력하세요.</p>
        </div>

        <div class="section">
            <h2>1. 지역 기반 관광 정보 조회 (GET) - areaBasedList</h2>
            <label for="areaCode">지역 코드 (areaCode):</label>
            <input type="text" id="areaCode" value="1" placeholder="예: 1 (서울), 31 (경기도)">
            <label for="contentTypeIdArea">콘텐츠 타입 ID (contentTypeId):</label>
            <input type="text" id="contentTypeIdArea" value="12" placeholder="예: 12 (관광지)">
            <label for="numOfRowsArea">한 페이지 결과 수 (numOfRows):</label>
            <input type="number" id="numOfRowsArea" value="5">
            <label for="pageNoArea">페이지 번호 (pageNo):</label>
            <input type="number" id="pageNoArea" value="1">
            <button onclick="callAreaBasedList()">areaBasedList 호출 (GET)</button>
        </div>

        <div class="section">
            <h2>2. 공통 정보 조회 (POST) - detailCommon</h2>
            <label for="contentIdCommon">콘텐츠 ID (contentId):</label>
            <input type="text" id="contentIdCommon" value="126508" placeholder="예: 126508 (경복궁)">
            <label for="contentTypeIdCommon">콘텐츠 타입 ID (contentTypeId):</label>
            <input type="text" id="contentTypeIdCommon" value="12" placeholder="예: 12 (관광지)">
            <button onclick="callDetailCommon()">detailCommon 호출 (POST)</button>
        </div>

        <div class="section">
            <h2>3. 키워드 검색 (POST) - searchKeyword</h2>
            <label for="keyword">키워드 (keyword):</label>
            <input type="text" id="keyword" value="서울 N 타워">
            <label for="areaCodeKeyword">지역 코드 (areaCode):</label>
            <input type="text" id="areaCodeKeyword" value="1" placeholder="비워두면 전국 검색">
            <button onclick="callSearchKeyword()">searchKeyword 호출 (POST)</button>
        </div>
        
        <div class="section">
            <h2>4. 배치 요청 (POST) - batch</h2>
            <label for="batchOperations">배치 작업 목록 (JSON 형식):</label>
            <textarea id="batchOperations" rows="10" placeholder='[{"operation": "areaCode", "params": {"numOfRows": "2"}}, {"operation": "detailCommon", "params": {"contentId": "264305", "contentTypeId": "12"}}]'>[{"operation": "areaCode", "params": {"numOfRows": "2"}}, {"operation": "detailCommon", "params": {"contentId": "264305", "contentTypeId": "12"}}]</textarea>
            <button onclick="callBatchRequest()">batch 요청 (POST)</button>
        </div>

        <div class="section">
            <h2>5. 헬스 체크 (GET) - healthCheck</h2>
            <button onclick="callHealthCheck()">healthCheck 호출 (GET)</button>
        </div>

        <div class="section">
            <h2>6. 메트릭 조회 (GET) - metrics</h2>
            <button onclick="callMetrics()">metrics 호출 (GET - JSON)</button>
            <button onclick="callMetrics('text/plain')">metrics 호출 (GET - Prometheus)</button>
        </div>


        <h2>API 응답</h2>
        <pre id="responseOutput">여기에 API 응답이 표시됩니다.</pre>
    </div>

    <script>
        const getApiEndpoint = () => {
            const endpoint = document.getElementById('apiEndpoint').value;
            if (!endpoint || endpoint === "YOUR_SERVERLESS_FUNCTION_URL_HERE") {
                alert("API 엔드포인트 URL을 설정해주세요.");
                return null;
            }
            return endpoint;
        };

        const outputElement = document.getElementById('responseOutput');

        async function callApi(method, operation, params = {}, headers = {'Content-Type': 'application/json'}, body = null) {
            const API_ENDPOINT = getApiEndpoint();
            if (!API_ENDPOINT) return;

            outputElement.textContent = '요청 중...';
            outputElement.className = '';

            let url = API_ENDPOINT;
            let requestOptions = {
                method: method,
                headers: headers
            };

            if (method === 'GET') {
                const queryParams = new URLSearchParams({...params, operation});
                url += `?${queryParams.toString()}`;
            } else if (method === 'POST') {
                requestOptions.body = JSON.stringify({ operation, ...params, ...body });
            }


            try {
                const response = await fetch(url, requestOptions);
                const contentType = response.headers.get("content-type");
                let data;

                if (contentType && contentType.includes("application/json")) {
                    data = await response.json();
                    outputElement.textContent = JSON.stringify(data, null, 2);
                    if (data.success === false || !response.ok) {
                        outputElement.className = 'error';
                    } else {
                        outputElement.className = 'success';
                    }
                } else if (contentType && contentType.includes("text/plain")) {
                    data = await response.text();
                    outputElement.textContent = data;
                    if (!response.ok) {
                        outputElement.className = 'error';
                    } else {
                        outputElement.className = 'success';
                    }
                } else {
                     data = await response.text(); // 예상치 못한 content-type
                     outputElement.textContent = `예상치 못한 Content-Type: ${contentType}\n\n${data}`;
                     outputElement.className = 'error';
                }


            } catch (error) {
                console.error('API 호출 오류:', error);
                outputElement.textContent = `오류 발생: ${error.message}\n\n${error.stack}`;
                outputElement.className = 'error';
            }
        }

        function callAreaBasedList() {
            const params = {
                areaCode: document.getElementById('areaCode').value || undefined,
                contentTypeId: document.getElementById('contentTypeIdArea').value || undefined,
                numOfRows: document.getElementById('numOfRowsArea').value || undefined,
                pageNo: document.getElementById('pageNoArea').value || undefined
            };
            // 빈 값은 undefined로 보내서 백엔드 기본값 사용 유도
            for (const key in params) {
                if (params[key] === '') params[key] = undefined;
            }
            callApi('GET', 'areaBasedList', params);
        }

        function callDetailCommon() {
            const params = {
                contentId: document.getElementById('contentIdCommon').value,
                contentTypeId: document.getElementById('contentTypeIdCommon').value
            };
            callApi('POST', 'detailCommon', {}, {'Content-Type': 'application/json'}, params);
        }

        function callSearchKeyword() {
            const params = {
                keyword: document.getElementById('keyword').value,
                areaCode: document.getElementById('areaCodeKeyword').value || undefined
            };
            if (params.areaCode === '') params.areaCode = undefined;
            callApi('POST', 'searchKeyword', {}, {'Content-Type': 'application/json'}, params);
        }

        function callBatchRequest() {
            try {
                const operationsText = document.getElementById('batchOperations').value;
                const operations = JSON.parse(operationsText); // 입력된 JSON 문자열을 파싱
                // POST 요청 시 body는 operation과 params를 포함하는 객체가 아니라,
                // 백엔드 batchHandler가 예상하는 { operations: [...] } 형태여야 합니다.
                callApi('POST', 'batch', {}, {'Content-Type': 'application/json'}, { operations });
            } catch (e) {
                outputElement.textContent = `배치 작업 목록 JSON 파싱 오류: ${e.message}`;
                outputElement.className = 'error';
            }
        }

        function callHealthCheck() {
            callApi('GET', 'healthCheck');
        }

        function callMetrics(acceptType = 'application/json') {
            const headers = acceptType === 'text/plain' ? { 'Accept': 'text/plain' } : { 'Accept': 'application/json' };
            callApi('GET', 'metrics', {}, headers);
        }

    </script>
</body>
</html>
