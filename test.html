<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourAPI 4.3 Enterprise Test Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 헤더 */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .language-selector, .api-url-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            backdrop-filter: blur(10px);
        }

        .api-url-input {
            min-width: 300px;
            font-family: 'Courier New', monospace;
        }

        .language-selector option {
            background: var(--primary-color);
            color: white;
        }

        .deployment-badge {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* 시스템 상태 */
        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .status-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.2s ease;
        }

        .status-card:hover {
            transform: translateY(-2px);
        }

        .status-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .status-card.healthy .icon { color: var(--success-color); }
        .status-card.warning .icon { color: var(--warning-color); }
        .status-card.error .icon { color: var(--error-color); }

        /* 탭 네비게이션 */
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .tab:hover {
            background: var(--bg-color);
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        /* 탭 컨텐츠 */
        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        /* 폼 스타일 */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* 버튼 */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--text-secondary);
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-danger {
            background: var(--error-color);
        }

        /* 결과 표시 */
        .results {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .results-header {
            background: var(--bg-color);
            padding: 1rem 1.5rem;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-content {
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .result-item {
            background: var(--bg-color);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
        }

        .result-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        /* JSON 표시 */
        .json-viewer {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        /* 로딩 애니메이션 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 성능 메트릭 */
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .metric {
            text-align: center;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 6px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                text-align: center;
            }

            .api-url-input {
                min-width: auto;
                width: 100%;
            }
        }

        /* 알림 */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .alert-info {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }

        /* 결과 카드 스타일 */
        .result-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .result-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.2s ease;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .result-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .result-card .content-id {
            background: var(--bg-color);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .result-card .content-id:hover {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <h1>
                <i class="fas fa-map-marked-alt"></i>
                TourAPI 4.3 Enterprise Test Dashboard
            </h1>
            <p>한국관광공사 TourAPI 4.0 v4.3 완전 구현 시스템 테스트</p>
            <div class="header-controls">
                <span class="deployment-badge">
                    <i class="fas fa-cloud"></i> VERCEL DEPLOYED
                </span>
                <select class="language-selector" id="languageSelector">
                    <option value="ko">한국어</option>
                    <option value="en">English</option>
                </select>
                <input type="url" class="api-url-input" id="apiUrl" placeholder="API 서버 URL" value="https://healingk.vercel.app" readonly>
                <button class="btn btn-secondary" onclick="healthCheck()">
                    <i class="fas fa-heartbeat"></i> Health Check
                </button>
            </div>
        </header>

        <!-- 연결 상태 알림 -->
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            배포된 서버 <strong>https://healingk.vercel.app</strong>에 연결됩니다. 
            첫 요청 시 콜드 스타트로 인해 응답이 느릴 수 있습니다.
        </div>

        <!-- 시스템 상태 -->
        <div class="system-status">
            <div class="status-card healthy" id="apiStatus">
                <div class="icon"><i class="fas fa-server"></i></div>
                <h3>API 상태</h3>
                <p id="apiStatusText">연결 대기중</p>
            </div>
            <div class="status-card" id="cacheStatus">
                <div class="icon"><i class="fas fa-database"></i></div>
                <h3>캐시 상태</h3>
                <p id="cacheStatusText">-</p>
            </div>
            <div class="status-card" id="performanceStatus">
                <div class="icon"><i class="fas fa-tachometer-alt"></i></div>
                <h3>평균 응답시간</h3>
                <p id="performanceStatusText">-</p>
            </div>
            <div class="status-card" id="requestStatus">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <h3>총 요청 수</h3>
                <p id="requestStatusText">0</p>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('areaBasedList')">
                <i class="fas fa-list"></i> 지역별 관광정보
            </button>
            <button class="tab" onclick="showTab('searchKeyword')">
                <i class="fas fa-search"></i> 키워드 검색
            </button>
            <button class="tab" onclick="showTab('detailCommon')">
                <i class="fas fa-info-circle"></i> 상세정보
            </button>
            <button class="tab" onclick="showTab('locationBased')">
                <i class="fas fa-map-marker-alt"></i> 위치기반 검색
            </button>
            <button class="tab" onclick="showTab('batchDetail')">
                <i class="fas fa-layer-group"></i> 배치 처리
            </button>
            <button class="tab" onclick="showTab('systemMonitor')">
                <i class="fas fa-monitor-waveform"></i> 시스템 모니터
            </button>
        </div>

        <!-- 지역별 관광정보 탭 -->
        <div id="areaBasedList" class="tab-content active">
            <h2><i class="fas fa-list"></i> 지역별 관광정보 조회</h2>
            <form onsubmit="searchAreaBased(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="areaCode">지역코드</label>
                        <select id="areaCode">
                            <option value="">전체</option>
                            <option value="1">서울</option>
                            <option value="6">부산</option>
                            <option value="4">대구</option>
                            <option value="2">인천</option>
                            <option value="5">광주</option>
                            <option value="3">대전</option>
                            <option value="7">울산</option>
                            <option value="8">세종</option>
                            <option value="31">경기</option>
                            <option value="32">강원</option>
                            <option value="33">충북</option>
                            <option value="34">충남</option>
                            <option value="35">경북</option>
                            <option value="36">경남</option>
                            <option value="37">전북</option>
                            <option value="38">전남</option>
                            <option value="39">제주</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contentTypeId">콘텐츠 타입</label>
                        <select id="contentTypeId">
                            <option value="">전체</option>
                            <option value="12">관광지</option>
                            <option value="14">문화시설</option>
                            <option value="15">축제/공연/행사</option>
                            <option value="25">여행코스</option>
                            <option value="28">레포츠</option>
                            <option value="32">숙박</option>
                            <option value="38">쇼핑</option>
                            <option value="39">음식점</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="numOfRows">검색 개수</label>
                        <select id="numOfRows">
                            <option value="10">10개</option>
                            <option value="20">20개</option>
                            <option value="50">50개</option>
                            <option value="100">100개</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="arrange">정렬</label>
                        <select id="arrange">
                            <option value="C">수정일순</option>
                            <option value="A">제목순</option>
                            <option value="B">조회순</option>
                            <option value="D">등록일순</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="userLat">사용자 위도 (선택)</label>
                        <input type="number" id="userLat" step="any" placeholder="37.5665">
                    </div>
                    <div class="form-group">
                        <label for="userLng">사용자 경도 (선택)</label>
                        <input type="number" id="userLng" step="any" placeholder="126.9780">
                    </div>
                    <div class="form-group">
                        <label for="radius">반경 (km, 선택)</label>
                        <input type="number" id="radius" min="1" max="20" placeholder="10">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="button" class="btn btn-secondary" onclick="getMyLocation()">
                            <i class="fas fa-crosshairs"></i> 내 위치
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-search"></i> 검색하기
                </button>
            </form>
        </div>

        <!-- 키워드 검색 탭 -->
        <div id="searchKeyword" class="tab-content">
            <h2><i class="fas fa-search"></i> 키워드 검색</h2>
            <form onsubmit="searchKeyword(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="keyword">검색 키워드</label>
                        <input type="text" id="keyword" placeholder="예: 경복궁, 해운대, 제주도" required>
                    </div>
                    <div class="form-group">
                        <label for="keywordAreaCode">지역코드</label>
                        <select id="keywordAreaCode">
                            <option value="">전체</option>
                            <option value="1">서울</option>
                            <option value="6">부산</option>
                            <option value="39">제주</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="keywordNumOfRows">검색 개수</label>
                        <select id="keywordNumOfRows">
                            <option value="10">10개</option>
                            <option value="20">20개</option>
                            <option value="50">50개</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-search"></i> 검색하기
                </button>
            </form>
        </div>

        <!-- 상세정보 탭 -->
        <div id="detailCommon" class="tab-content">
            <h2><i class="fas fa-info-circle"></i> 상세정보 조회</h2>
            <form onsubmit="getDetailCommon(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="contentId">콘텐츠 ID</label>
                        <input type="text" id="contentId" placeholder="예: 126508" required>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="submit" class="btn">
                            <i class="fas fa-info-circle"></i> 상세정보 조회
                        </button>
                    </div>
                </div>
            </form>
            <div class="alert alert-success">
                <i class="fas fa-lightbulb"></i>
                팁: 위의 지역별 검색이나 키워드 검색 결과에서 콘텐츠 ID를 클릭해서 복사하세요.
            </div>
        </div>

        <!-- 위치기반 검색 탭 -->
        <div id="locationBased" class="tab-content">
            <h2><i class="fas fa-map-marker-alt"></i> 위치기반 검색</h2>
            <form onsubmit="searchLocationBased(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="mapX">경도 (X 좌표)</label>
                        <input type="number" id="mapX" step="any" placeholder="126.9780" required>
                    </div>
                    <div class="form-group">
                        <label for="mapY">위도 (Y 좌표)</label>
                        <input type="number" id="mapY" step="any" placeholder="37.5665" required>
                    </div>
                    <div class="form-group">
                        <label for="locationRadius">반경 (m)</label>
                        <input type="number" id="locationRadius" min="1" max="20000" value="1000" required>
                    </div>
                    <div class="form-group">
                        <label for="locationNumOfRows">검색 개수</label>
                        <select id="locationNumOfRows">
                            <option value="10">10개</option>
                            <option value="20">20개</option>
                            <option value="50">50개</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <button type="button" class="btn btn-secondary" onclick="getMyLocationForSearch()">
                        <i class="fas fa-crosshairs"></i> 내 위치 사용
                    </button>
                    <button type="submit" class="btn">
                        <i class="fas fa-search"></i> 검색하기
                    </button>
                </div>
            </form>
        </div>

        <!-- 배치 처리 탭 -->
        <div id="batchDetail" class="tab-content">
            <h2><i class="fas fa-layer-group"></i> 배치 상세정보 조회</h2>
            <form onsubmit="getBatchDetail(event)">
                <div class="form-group">
                    <label for="contentIds">콘텐츠 ID 목록 (쉼표로 구분)</label>
                    <textarea id="contentIds" rows="4" placeholder="예: 126508, 126509, 126510, 126511, 126512" required></textarea>
                </div>
                <button type="submit" class="btn">
                    <i class="fas fa-layer-group"></i> 배치 조회하기
                </button>
            </form>
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                배치 처리는 여러 개의 콘텐츠 ID를 한 번에 조회할 수 있습니다. 성능 및 에러 통계를 확인할 수 있습니다.
            </div>
        </div>

        <!-- 시스템 모니터 탭 -->
        <div id="systemMonitor" class="tab-content">
            <h2><i class="fas fa-monitor-waveform"></i> 시스템 모니터링</h2>
            <div class="form-row">
                <button class="btn" onclick="getSystemHealth()">
                    <i class="fas fa-heartbeat"></i> 헬스체크
                </button>
                <button class="btn btn-secondary" onclick="getCacheStats()">
                    <i class="fas fa-database"></i> 캐시 통계
                </button>
                <button class="btn btn-success" onclick="runTests()">
                    <i class="fas fa-vials"></i> 테스트 실행
                </button>
                <button class="btn btn-warning" onclick="testQuickDemo()">
                    <i class="fas fa-rocket"></i> 빠른 데모
                </button>
            </div>
            <div id="systemMetrics" class="metrics" style="display: none;">
                <!-- 메트릭이 여기에 표시됩니다 -->
            </div>
        </div>

        <!-- 결과 표시 영역 -->
        <div class="results">
            <div class="results-header">
                <h3 id="resultsTitle">
                    <i class="fas fa-chart-bar"></i> 검색 결과
                </h3>
                <div>
                    <button class="btn btn-secondary" onclick="copyResults()">
                        <i class="fas fa-copy"></i> 복사
                    </button>
                    <button class="btn btn-secondary" onclick="clearResults()">
                        <i class="fas fa-eraser"></i> 지우기
                    </button>
                </div>
            </div>
            <div class="results-content" id="resultsContent">
                <p style="text-align: center; color: var(--text-secondary); margin: 2rem 0;">
                    <i class="fas fa-info-circle"></i>
                    검색을 시작하면 결과가 여기에 표시됩니다.
                </p>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentLanguage = 'ko';
        let requestCount = 0;
        let totalResponseTime = 0;
        let results = [];

        // API 기본 URL (배포 서버)
        const API_BASE_URL = 'https://healingk.vercel.app';

        // 언어 설정
        const messages = {
            ko: {
                searching: '검색 중...',
                error: '오류가 발생했습니다',
                success: '성공',
                noResults: '검색 결과가 없습니다',
                locationError: '위치 정보를 가져올 수 없습니다',
                copied: '클립보드에 복사되었습니다',
                coldStart: '서버 콜드 스타트 중... 잠시만 기다려주세요.'
            },
            en: {
                searching: 'Searching...',
                error: 'An error occurred',
                success: 'Success',
                noResults: 'No results found',
                locationError: 'Unable to get location',
                copied: 'Copied to clipboard',
                coldStart: 'Server cold start... Please wait.'
            }
        };

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            const languageSelector = document.getElementById('languageSelector');
            languageSelector.addEventListener('change', function() {
                currentLanguage = this.value;
                updateLanguage();
            });

            // 콜드 스타트 경고
            showAlert('info', 'Vercel 서버 첫 요청 시 콜드 스타트로 10-15초 소요될 수 있습니다.');

            // 초기 헬스체크 (조금 지연해서 실행)
            setTimeout(healthCheck, 2000);
        });

        // 언어 업데이트
        function updateLanguage() {
            console.log('Language changed to:', currentLanguage);
        }

        // 탭 전환
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // API 호출 함수 (배포 서버용 수정)
        async function callAPI(endpoint, params = {}, method = 'GET') {
            const startTime = Date.now();
            
            try {
                showLoading(true);
                
                let url = `${API_BASE_URL}${endpoint}`;
                let options = {
                    method: method,
                    headers: {
                        'Accept': 'application/json',
                        'Accept-Language': currentLanguage,
                        'Content-Type': 'application/json'
                    }
                };

                if (method === 'GET') {
                    const urlObj = new URL(url);
                    Object.entries(params).forEach(([key, value]) => {
                        if (value !== null && value !== '' && value !== undefined) {
                            urlObj.searchParams.append(key, value);
                        }
                    });
                    url = urlObj.toString();
                } else {
                    options.body = JSON.stringify(params);
                }

                const response = await fetch(url, options);
                const data = await response.json();
                const responseTime = Date.now() - startTime;
                
                // 통계 업데이트
                requestCount++;
                totalResponseTime += responseTime;
                updateStats(responseTime, data.success);

                if (data.success) {
                    displayResults(data, responseTime);
                    updateApiStatus('healthy', '정상');
                } else {
                    throw new Error(data.error?.message || 'Unknown error');
                }

                return data;
            } catch (error) {
                console.error('API Error:', error);
                
                // 콜드 스타트 감지
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showAlert('warning', messages[currentLanguage].coldStart);
                } else {
                    displayError(error.message);
                }
                
                updateApiStatus('error', '오류');
                throw error;
            } finally {
                showLoading(false);
            }
        }

        // 각 API 호출 함수들 (엔드포인트 수정)
        async function searchAreaBased(event) {
            event.preventDefault();
            
            const params = {
                operation: 'areaBasedList',
                areaCode: document.getElementById('areaCode').value,
                contentTypeId: document.getElementById('contentTypeId').value,
                numOfRows: document.getElementById('numOfRows').value,
                arrange: document.getElementById('arrange').value,
                userLat: document.getElementById('userLat').value,
                userLng: document.getElementById('userLng').value,
                radius: document.getElementById('radius').value
            };

            await callAPI('/api/tour', params);
        }

        async function searchKeyword(event) {
            event.preventDefault();
            
            const params = {
                operation: 'searchKeyword',
                keyword: document.getElementById('keyword').value,
                areaCode: document.getElementById('keywordAreaCode').value,
                numOfRows: document.getElementById('keywordNumOfRows').value
            };

            await callAPI('/api/tour', params);
        }

        async function getDetailCommon(event) {
            event.preventDefault();
            
            const params = {
                operation: 'detailCommon',
                contentId: document.getElementById('contentId').value
            };

            await callAPI('/api/tour', params);
        }

        async function searchLocationBased(event) {
            event.preventDefault();
            
            const params = {
                operation: 'locationBasedList',
                mapX: document.getElementById('mapX').value,
                mapY: document.getElementById('mapY').value,
                radius: document.getElementById('locationRadius').value,
                numOfRows: document.getElementById('locationNumOfRows').value
            };

            await callAPI('/api/tour', params);
        }

        async function getBatchDetail(event) {
            event.preventDefault();
            
            const contentIdsText = document.getElementById('contentIds').value;
            const contentIds = contentIdsText.split(',').map(id => id.trim()).filter(id => id);
            
            const params = {
                operation: 'batchDetail',
                contentIds: contentIds
            };

            await callAPI('/api/tour', params, 'POST');
        }

        // 내 위치 가져오기
        function getMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        document.getElementById('userLat').value = position.coords.latitude.toFixed(6);
                        document.getElementById('userLng').value = position.coords.longitude.toFixed(6);
                        showAlert('success', '위치 정보를 가져왔습니다.');
                    },
                    function(error) {
                        showAlert('error', messages[currentLanguage].locationError);
                    }
                );
            } else {
                showAlert('error', '브라우저에서 위치 서비스를 지원하지 않습니다.');
            }
        }

        function getMyLocationForSearch() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        document.getElementById('mapX').value = position.coords.longitude.toFixed(6);
                        document.getElementById('mapY').value = position.coords.latitude.toFixed(6);
                        showAlert('success', '위치 정보를 가져왔습니다.');
                    },
                    function(error) {
                        showAlert('error', messages[currentLanguage].locationError);
                    }
                );
            }
        }

        // 헬스체크
        async function healthCheck() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.status === 'healthy') {
                    updateApiStatus('healthy', '정상');
                    updateCacheStatus(data.cache);
                    showAlert('success', '시스템이 정상적으로 작동 중입니다.');
                } else {
                    updateApiStatus('warning', '경고');
                }
            } catch (error) {
                updateApiStatus('error', '연결 실패');
                showAlert('error', 'API 서버에 연결할 수 없습니다. 서버가 콜드 스타트 중일 수 있습니다.');
            }
        }

        async function getSystemHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`);
                const data = await response.json();
                
                displayResults({
                    success: true,
                    operation: 'healthCheck',
                    data: data,
                    metadata: {
                        operation: 'healthCheck',
                        timestamp: new Date().toISOString()
                    }
                }, 0);
                
                showSystemMetrics(data);
            } catch (error) {
                displayError('헬스체크 실패: ' + error.message);
            }
        }

        async function getCacheStats() {
            await getSystemHealth();
        }

        async function runTests() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/test`);
                const data = await response.json();
                
                displayResults({
                    success: true,
                    operation: 'runTests',
                    data: data,
                    metadata: {
                        operation: 'runTests',
                        timestamp: new Date().toISOString()
                    }
                }, 0);
                
                if (data.success !== false) {
                    showAlert('success', '모든 테스트가 통과했습니다.');
                } else {
                    showAlert('warning', '일부 테스트가 실패했습니다.');
                }
            } catch (error) {
                displayError('테스트 실행 실패: ' + error.message);
            }
        }

        // 빠른 데모 함수
        async function testQuickDemo() {
            showAlert('info', '빠른 데모를 시작합니다...');
            
            try {
                // 1. 서울 관광지 검색
                await callAPI('/api/tour', {
                    operation: 'areaBasedList',
                    areaCode: '1',
                    contentTypeId: '12',
                    numOfRows: '5'
                });
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 2. 키워드 검색
                await callAPI('/api/tour', {
                    operation: 'searchKeyword',
                    keyword: '경복궁',
                    numOfRows: '3'
                });
                
                showAlert('success', '빠른 데모가 완료되었습니다!');
            } catch (error) {
                showAlert('error', '데모 실행 중 오류가 발생했습니다.');
            }
        }

        // 결과 표시 (카드 형태로 개선)
        function displayResults(data, responseTime) {
            results.push({
                timestamp: new Date().toISOString(),
                operation: data.operation,
                data: data,
                responseTime: responseTime
            });

            const resultsContent = document.getElementById('resultsContent');
            const resultsTitle = document.getElementById('resultsTitle');
            
            resultsTitle.innerHTML = `<i class="fas fa-chart-bar"></i> ${data.operation} 결과 (${responseTime}ms)`;
            
            let resultHtml = '';
            
            // 검색 결과인 경우 카드 형태로 표시
            if (data.data?.items && Array.isArray(data.data.items)) {
                resultHtml = `
                    <div class="result-item">
                        <div class="result-meta">
                            <strong>작업:</strong> ${data.operation} | 
                            <strong>응답시간:</strong> ${responseTime}ms | 
                            <strong>시간:</strong> ${new Date().toLocaleString()} |
                            <strong>결과:</strong> ${data.data.items.length}개
                            ${data.metadata?.cache?.fromCache ? ' | <span style="color: var(--success-color)">캐시됨</span>' : ''}
                        </div>
                        <div class="result-cards">
                            ${data.data.items.slice(0, 10).map(item => `
                                <div class="result-card">
                                    <h4>${item.title || 'No Title'}</h4>
                                    <p><strong>주소:</strong> ${item.addr1 || 'No Address'}</p>
                                    <p><strong>타입:</strong> ${item.meta?.typeName || 'Unknown'} ${item.meta?.typeIcon || ''}</p>
                                    <p><strong>지역:</strong> ${item.meta?.areaName || 'Unknown'} ${item.meta?.areaEmoji || ''}</p>
                                    ${item.distance ? `<p><strong>거리:</strong> ${item.meta?.distanceText || item.distance + 'km'}</p>` : ''}
                                    <div class="content-id" onclick="copyContentId('${item.contentId}')" title="클릭하여 복사">
                                        ID: ${item.contentId}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${data.data.items.length > 10 ? `<p style="text-align: center; color: var(--text-secondary); margin-top: 1rem;">... 외 ${data.data.items.length - 10}개 더 (전체 JSON에서 확인)</p>` : ''}
                        <details style="margin-top: 1rem;">
                            <summary style="cursor: pointer; color: var(--primary-color);">전체 JSON 데이터 보기</summary>
                            <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                        </details>
                    </div>
                `;
            } else {
                // 일반 JSON 결과
                resultHtml = `
                    <div class="result-item">
                        <div class="result-meta">
                            <strong>작업:</strong> ${data.operation} | 
                            <strong>응답시간:</strong> ${responseTime}ms | 
                            <strong>시간:</strong> ${new Date().toLocaleString()}
                            ${data.metadata?.cache?.fromCache ? ' | <span style="color: var(--success-color)">캐시됨</span>' : ''}
                        </div>
                        <div class="json-viewer">${JSON.stringify(data, null, 2)}</div>
                    </div>
                `;
            }
            
            resultsContent.innerHTML = resultHtml + resultsContent.innerHTML;
        }

        // 콘텐츠 ID 복사 함수
        function copyContentId(contentId) {
            navigator.clipboard.writeText(contentId).then(() => {
                showAlert('success', `콘텐츠 ID ${contentId}가 복사되었습니다.`);
                document.getElementById('contentId').value = contentId;
            });
        }

        // 에러 표시
        function displayError(message) {
            const resultsContent = document.getElementById('resultsContent');
            const resultsTitle = document.getElementById('resultsTitle');
            
            resultsTitle.innerHTML = `<i class="fas fa-exclamation-triangle"></i> 오류 발생`;
            
            const errorHtml = `
                <div class="result-item" style="border-left-color: var(--error-color)">
                    <div class="result-meta">
                        <strong>오류:</strong> ${new Date().toLocaleString()}
                    </div>
                    <div style="color: var(--error-color); padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 6px;">
                        <i class="fas fa-exclamation-circle"></i> ${message}
                    </div>
                </div>
            `;
            
            resultsContent.innerHTML = errorHtml + resultsContent.innerHTML;
        }

        // 시스템 메트릭 표시
        function showSystemMetrics(healthData) {
            const metricsContainer = document.getElementById('systemMetrics');
            
            const metricsHtml = `
                <div class="metric">
                    <div class="metric-value">${healthData.uptime?.hours || 0}h</div>
                    <div class="metric-label">업타임</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${healthData.memory?.heapUsed || 0}MB</div>
                    <div class="metric-label">메모리 사용량</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${healthData.cache?.size || 0}</div>
                    <div class="metric-label">캐시 항목</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${Math.round(healthData.cache?.hitRate || 0)}%</div>
                    <div class="metric-label">캐시 적중률</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${healthData.config?.maxConcurrent || 0}</div>
                    <div class="metric-label">최대 동시요청</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${healthData.config?.environment || 'unknown'}</div>
                    <div class="metric-label">환경</div>
                </div>
            `;
            
            metricsContainer.innerHTML = metricsHtml;
            metricsContainer.style.display = 'grid';
        }

        // 상태 업데이트 함수들
        function updateStats(responseTime, success) {
            const avgResponseTime = totalResponseTime / requestCount;
            document.getElementById('performanceStatusText').textContent = `${Math.round(avgResponseTime)}ms`;
            document.getElementById('requestStatusText').textContent = requestCount;
        }

        function updateApiStatus(status, text) {
            const statusCard = document.getElementById('apiStatus');
            statusCard.className = `status-card ${status}`;
            document.getElementById('apiStatusText').textContent = text;
        }

        function updateCacheStatus(cacheData) {
            if (cacheData) {
                document.getElementById('cacheStatusText').textContent = 
                    `${cacheData.size}/${cacheData.maxSize} (${Math.round(cacheData.hitRate)}%)`;
            }
        }

        // 유틸리티 함수들
        function showLoading(show) {
            const buttons = document.querySelectorAll('button[type="submit"], .btn');
            buttons.forEach(button => {
                if (show) {
                    button.disabled = true;
                    const originalText = button.innerHTML;
                    button.setAttribute('data-original-text', originalText);
                    button.innerHTML = '<div class="loading"></div> ' + messages[currentLanguage].searching;
                } else {
                    button.disabled = false;
                    const originalText = button.getAttribute('data-original-text');
                    if (originalText) {
                        button.innerHTML = originalText;
                    }
                }
            });
        }

        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'info' ? 'info-circle' : 'exclamation-triangle'}"></i>
                ${message}
            `;
            
            document.querySelector('.container').insertBefore(alert, document.querySelector('.tabs'));
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function copyResults() {
            if (results.length === 0) {
                showAlert('warning', '복사할 결과가 없습니다.');
                return;
            }
            
            const text = JSON.stringify(results, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                showAlert('success', messages[currentLanguage].copied);
            });
        }

        function clearResults() {
            results = [];
            document.getElementById('resultsContent').innerHTML = `
                <p style="text-align: center; color: var(--text-secondary); margin: 2rem 0;">
                    <i class="fas fa-info-circle"></i>
                    검색을 시작하면 결과가 여기에 표시됩니다.
                </p>
            `;
            document.getElementById('resultsTitle').innerHTML = '<i class="fas fa-chart-bar"></i> 검색 결과';
        }
    </script>
</body>
</html>
